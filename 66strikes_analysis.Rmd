---
title: "US Military Strikes, 1966"
output:
  html_document: default
  pdf_document: default
date: "2024-09-27"
always_allow_html: yes
---

This document provides cursory descriptive statistics on work stoppages in the United States for the year 1966. The data for this project is drawn from archival documents that were generated by the Labor Relations staff at the Detroit Tank Arsenal (DTA).

The year 1966 is an interesting and important year regarding work stoppages within the military industrial complex. The archival holdings of the DTA's Labor Relations staff demonstrate a ten-fold increase in strike activity from the years 1963 and '64 on one side (1965 is missing from the archives) and 1966 on the other. 

Furthermore, the data found in this document turns our current picture of 1960s military industry labor on its head. Under "Ordnance and accessories," The Bureau of Labor Statistics Work Stoppage Analysis for the year 1966 lists only thirteen strikes involving 8680 workers and 62,500 worker-hours lost. The DTA Labor Relations documents demonstrate work stoppages on a much wider scale: around eight times as many strikes involving five times as many workers.

It should be noted well that limitations within the data mean that this increase is only the beginning of a picture much deeper and wider than the one found in the BLS report.

This finding allows us to begin understanding the social and political economic effects of the Johnson administration's decision to intensify military involvement in Vietnam and begin folding this new understanding into the wider history of wartime political economy and labor history in the twentieth century US.

```{r setup, echo=FALSE, eval=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r libraries, include=FALSE}

#set wd, library, import data

setwd("C:\\Users\\alex\\Dropbox\\DTA project\\coding\\66strikes") #for home

#setwd("C:\\Users\\atrahan\\Desktop\\coding\\66strikes") #for work


library(tidyverse)
library (knitr)
library (dplyr)
library(ggplot2)
library (tidyr) #for reshaping
library(stringr) #for strings
library(lubridate) #for dates
library(tidygeocoder) #for geocoding
library(leaflet) #for maps
library(leaflet.extras)
library(scales)  # Load the scales package for comma formatting
library(maps)  # For US state polygons
library(sp)    # For spatial data


```



```{r wrangling, echo=FALSE, warning=FALSE}
#load strike data

strike <- read.csv("strike_geocoded.csv")

#wrangling the data

#remove qual notes, bad Days.Lost column
strike <- strike %>% select(-Notes, Days.Lost)

# Replace blank observations with NA, but only for character columns
strike <- strike %>%
  mutate(across(where(is.character), ~ na_if(., "")))

#strikers column
colnames(strike)[which(colnames(strike) == "Number.of.Employees.on.Strike")] <- "strikers"

# Ensure 'Date.Started' and 'Date.Settled' are in date format, then create 'Length' column
strike <- strike %>%
  mutate(
    Date.Started = parse_date_time(Date.Started, orders = c("mdy", "dmy", "ymd"), quiet = TRUE),
    Date.Settled = parse_date_time(Date.Settled, orders = c("mdy", "dmy", "ymd"), quiet = TRUE),
    strike_length = as.numeric(difftime(Date.Settled, Date.Started, units = "days"))  # Create 'strike_length' column
  )

# Add a new column 'worker_days_lost' by multiplying 'strike_length' by 'strikers'
strike <- strike %>%
  mutate(
    strike_length = as.numeric(strike_length),  # Convert 'strike_length' to numeric
    strikers = as.numeric(strikers),              # Convert 'strikers' to numeric
    worker_days_lost = strike_length * strikers   # Create 'worker_days_lost'
  )

#cleaning up "Type" column
strike <- strike %>%
  mutate(Type = tolower(Type)) %>%
  mutate(Type = ifelse(str_detect(Type, "potential"), "potential", Type)) %>%
  mutate(Type = ifelse(str_detect(Type, "wildcat"), "wildcat", Type)) %>%
  mutate(Type = ifelse(str_detect(Type, "strike"), "strike", Type))

# Remove all spaces from observations in the 'Strikers' column
strike$strikers <- as.numeric(str_squish(strike$strikers))

#remove canada and years other than 1966

strike <- strike %>%
  filter(!str_detect(Location, "Canada"))  # Keep rows where Location does not contain "Canada"

strike <- strike %>%
  filter(Date.Started >= as.Date("1966-01-01"))  # Keep rows where Date.Started is on or after January 1, 1966


```

```{r, echo=FALSE}
# Create a summary table with total events and total strikers
total_summary <- strike %>%
  summarise(
    Total_Events = n(),                      # Count total number of events (strikes)
    Total_Workers = sum(strikers, na.rm = TRUE)  # Sum total workers involved
  )

# Print the summary table
kable(total_summary, caption = "Total Events and Total Workers Involved")
```
```{r, echo=FALSE}
# Filter the strike dataframe to exclude rows where 'Type' is exactly 'potential'
strike_filtered <- strike %>%
  filter(Type != "potential")  # Exclude rows with 'Type' equal to 'potential'
  
```


```{r,echo=FALSE}
# Count observations in the 'Type' column
type_counts <- strike %>%
  group_by(Type) %>%                # Group by 'Type'
  summarise(count = n(),           # Count the number of occurrences
            .groups = "drop")      # Drop grouping after summarising

# Print the resulting table
kable(type_counts, caption = "Count of Observations by Type")

```


```{r summary_table, echo=FALSE}


# Create a summary table with total strikes, total strikers, total strike length, and total hours lost
strike_summary <- strike_filtered %>%
  summarise(
    total_strikes = comma(n()),                        
    total_strikers = comma(sum(strikers, na.rm = TRUE)), 
    worker_days_lost = comma(sum(worker_days_lost,na.rm = TRUE))
  )

# Print the table
kable(strike_summary, caption = "Summary of Total Strikes, Total Strikers, and Total Workdays Lost to both Authorized and Wildcat Strikes")


```

```{r more_summary, echo=FALSE}
# Summary statistics for multiple columns (e.g., 'Strikers' and 'Length' of strikes)
strike_summary2 <- strike_filtered %>%
  summarise(
    mean_strikers = mean(strikers, na.rm = TRUE),
    median_strikers = median(strikers, na.rm = TRUE),
    sd_strikers = sd(strikers, na.rm = TRUE),
    min_strikers = min(strikers, na.rm = TRUE),
    max_strikers = max(strikers, na.rm = TRUE),
    mean_length = mean(strike_length, na.rm = TRUE),
    median_length = median(strike_length, na.rm = TRUE),
    min_length = min(strike_length, na.rm = TRUE),   # Add minimum length
    max_length = max(strike_length, na.rm = TRUE)    # Add maximum length
  )

kable(strike_summary2, caption = "More Summary")

```



```{r strikes_by_month, echo=FALSE}
# Create a new data frame summarizing strikes by month
monthly_strikes <- strike_filtered %>%
  mutate(Month = month(Date.Started, label = TRUE, abbr = TRUE)) %>%  # Extract month names
  group_by(Month) %>%                                                 # Group by month
  summarise(`Total Strikes` = n(),                                   # Count total strikes
            `Total Strikers` = sum(strikers, na.rm = TRUE),        # Sum total strikers
            .groups = "drop")                                       # Drop grouping after summarising

# Flip the orientation of the table
monthly_strikes_wide <- monthly_strikes %>%
  pivot_longer(cols = `Total Strikes`:`Total Strikers`,             # Pivot longer for two rows
               names_to = "Metric",                                  # Create a new column for metric names
               values_to = "Count")                                 # Create a new column for values

# Reshape into wide format
monthly_summary <- monthly_strikes_wide %>%
  pivot_wider(names_from = Month, values_from = Count)             # Pivot wider to get months as columns

# Print the resulting table
kable(monthly_summary, caption = "Total Strikes and Total Strikers by Month, 1966")
```

```{r, echo=FALSE}
library(ggplot2)

# Create a grouped bar chart
ggplot(monthly_strikes_wide, aes(x = Month, y = Count, fill = Metric)) +
  geom_bar(stat = "identity", position = "dodge") +  # Position bars side by side
  labs(title = "Total Strikes and Total Strikers by Month, 1966",
       x = "Month",
       y = "Count",
       fill = "Metric") +
  theme_minimal() +  # Use a minimal theme
  scale_y_continuous(labels = scales::comma) +  # Format y-axis with commas
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis text for readability

```


# Rustbelt Strikes


```{r state_map, echo=FALSE}
# Create a state-level summary of strikers
state_strike_summary <- strike %>%
  filter(!is.na(strikers)) %>%
  mutate(State = str_extract(Location, paste(state.name, collapse = "|"))) %>%
  group_by(State) %>%
  summarise(total_strikers = sum(strikers, na.rm = TRUE)) %>%
  drop_na()  # Drop any rows with missing state

# Get US state polygons
states <- map("state", fill = TRUE, plot = FALSE)

# Create a mapping of state names to maps package names
state_mapping <- data.frame(
  original = c("Michigan", "New York", "Washington"),
  maps_name = c("michigan:south", "new york:main", "washington:main"),
  stringsAsFactors = FALSE
)

# Replace state names in state_strike_summary with maps package names
state_strike_summary <- state_strike_summary %>%
  left_join(state_mapping, by = c("State" = "original")) %>%
  mutate(State = ifelse(is.na(maps_name), State, maps_name)) %>%
  select(-maps_name)  # Drop the temporary maps_name column

# Ensure state names in the summary are lowercase to match map data
state_strike_summary <- state_strike_summary %>%
  mutate(State = tolower(State))

# Debugging step: check the state summary
print(state_strike_summary)

# Match state data to polygons
state_match <- match(tolower(states$names), state_strike_summary$State)

# Add the total strikers to the state polygons
states$values <- state_strike_summary$total_strikers[state_match]

# Define a color palette
pal <- colorNumeric(
  palette = "YlOrRd",
  domain = state_strike_summary$total_strikers,  # Use total strikers for color domain
  na.color = "transparent"  # Set missing values to transparent
)

# Create the leaflet map
leaflet(states) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(values),
    fillOpacity = 0.7,
    color = "white",  # Border color
    weight = 1,       # Border thickness
    highlight = highlightOptions(
      weight = 2,
      color = "#666",
      fillOpacity = 0.9
    ),
    label = ~paste0(states$names, ": ", values, " strikers"),  # State name and number of strikers on hover
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "15px",
      direction = "auto"
    )
  ) %>%
  addLegend(
    pal = pal,
    values = state_strike_summary$total_strikers,
    opacity = 0.7,
    title = "Number of Strikers by State",
    position = "bottomright"
  )

```

```{r map, echo=FALSE}

strike_clean <- strike %>%
  filter(!is.na(longitude) & !is.na(latitude) & !is.na(strikers))  # Filter out rows with NA

# Create an interactive leaflet map
leaflet(data = strike_clean) %>%
  addTiles() %>%
  addCircleMarkers(~longitude, ~latitude, popup = ~paste("Location:", Location, "<br>", 
                                                         "Strikers:", strikers, "<br>",
                                                         "Strike Length:", strike_length, "days"),
                   radius = 5, color = "red", stroke = FALSE, fillOpacity = 0.5)
```

```{r rust_belt_map, echo=FALSE}
#create interactive rust belt map


# Define the states of interest
states_of_interest <- c("Wisconsin", "Illinois", "Indiana", "Michigan", "Ohio", "Pennsylvania", "New York")

# Filter the strike data for the specified states
filtered_strike <- strike %>%
  filter(str_detect(Location, paste(states_of_interest, collapse = "|")))

# Create a leaflet map for the specified states
leaflet(data = filtered_strike) %>%
  addTiles() %>%  # Add OpenStreetMap tiles
  setView(lng = -84, lat = 41, zoom = 6) %>%  # Center the map on the Midwest region
  addCircleMarkers(~longitude, ~latitude, popup = ~paste("Location:", Location, "<br>", 
                                                         "Strikers:", strikers, "<br>",
                                                         "Strike Length:", strike_length, "days"),
                   radius = 5, color = "red", stroke = FALSE, fillOpacity = 0.5) %>%
  addLegend("bottomright", pal = colorFactor("red", domain = NULL), values = NULL, title = "Strikes")

```




# What cities are in the data?


```{r, echo=FALSE}
# Summarize the total number of employees on strike and number of strikes for each city
city_summary <- strike %>%
  filter(!is.na(latitude) & !is.na(longitude)) %>%  # Keep rows with valid lat/long
  group_by(Location) %>%                             # Group by city
  summarise(
    total_strikes = n(),                            # Count the number of strikes
    total_strikers = sum(strikers, na.rm = TRUE)  # Sum of employees on strike
  ) %>%
  arrange(desc(total_strikes))                       # Arrange in descending order of strikes

# Create a table of the top 10 cities by total_strikes
top_10_strikes <- city_summary %>%
  slice_head(n = 10)  # Get the top 5 cities by total strikes

# Print the top 5 cities by total_strikes
kable(top_10_strikes, caption = "Top 10 Cities by Number of Strikes")

# Create a table of the top 10 cities by total_strikers
top_10_strikers <- city_summary %>%
  arrange(desc(total_strikers)) %>%  # Arrange by total_strikers in descending order
  slice_head(n = 10)  # Get the top 5 cities by total strikers

# Print the top 10 cities by total_strikers
kable(top_10_strikers, caption = "Top 10 Cities by Number of Strikers")

# Print the city summary sorted by total_strikers
city_summary_sorted <- city_summary %>%
  arrange(desc(total_strikers))  # Sort by total_strikers in descending order

kable(city_summary_sorted, caption = "Summary of Strikes and Employees on Strike by City")

```


```{r, echo=FALSE}
# Count the number of cities that appear only once
cities_once <- strike %>%
  filter(!is.na(latitude) & !is.na(longitude)) %>%  # Keep rows with valid lat/long
  group_by(Location) %>%                             # Group by city
  summarise(count = n()) %>%                        # Count occurrences
  filter(count == 1) %>%                            # Filter for cities that appear only once
  summarise(num_cities_once = n())                  # Count the number of such cities

# Print the number of cities that appear only once
kable(cities_once, caption="Number of 1-Strike Cities")
```



